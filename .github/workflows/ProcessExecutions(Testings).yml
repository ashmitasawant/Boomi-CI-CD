name: Testing Pipeline

# Controls when the workflow will run
on:
  push:
    paths:
     - 'DeploymentConfiguration/SubmissionPayload.json'
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
 processExecution:
   environment: Dev
   env: 
      MY_AUTHORIZATION: ${{ secrets.MY_AUTHORIZATION }}
   runs-on: ubuntu-latest
   needs: [getProcessInfo,getEnvironmentInfo]
   steps:
      - uses: actions/checkout@v2
      - name: Process Executions
        id: processExecutions
        run: |
             SubmissionPayload=$(cat ./DeploymentConfiguration/SubmissionPayload.json)
             echo $SubmissionPayload
        
             processes=${{needs.getProcessInfo.outputs.processNames}}
             echo $processes
             if [[ ${processes[*]} =~ (^|[[:space:]])TestWS($|[[:space:]]) ]]; 
             then
                  CODE=`curl --write-out '%{http_code}' \
                        --request POST \
                        --header 'authorization: ${{env.MY_AUTHORIZATION}}' \
                        --header 'content-type: application/json' \
                        --url 'https://c01-sg.integrate.boomi.com/ws/rest/personDetails/v1/personDetails/' \
                        --data '$SubmissionPayload'`
                        if [[ $CODE == *"200"* ]]
                        then
                           echo "The process executed successfully"
                        else 
                           echo $CODE
                        fi
             fi
             if [[ ${processes[*]} =~ (^|[[:space:]])TestForWS($|[[:space:]]) ]]; 
             then
                  CODE=`curl --write-out '%{http_code}' \
                        --request POST \
                        --header 'authorization: Basic dHJhaW5pbmdhc2htaXRhc2F3YW50LUQ5UDhKNy5ZRzFGQTQ6OWJmZDM5NWUtMzYxZC00MWFkLTgxMDctMTU0ZjU5Mzg0MDJm' \
                        --header 'content-type: application/json' \
                        --url 'https://c01-sg.integrate.boomi.com/ws/rest/employeeDetails/v1/employeeDetails/' \
                        --data '    {
                                      "name":"Abhishek",
                                      "age":20,
                                      "role":"Software Developer"
                                     }'`
                        if [[ $CODE == *"200"* ]]
                        then
                           echo "The process executed successfully"
                        else 
                           echo $CODE
                        fi
             fi
