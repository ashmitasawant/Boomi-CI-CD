name: Deployment Pipeline

# Controls when the workflow will run
on:
  push:
    paths:
     - 'DeploymentConfiguration/*'
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  deployments:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - name: Package Creation and Deployment 
        uses: actions/checkout@v2
      - id: setProcessLevelInfo
        run: |
            ProcessDetails=$(cat ./DeploymentConfiguration/ProcessDetails.HX_Demo.dev.json)
            echo $ProcessDetails
            listFiles=$(ls DeploymentConfiguration/)
            echo $listFiles
            
            for i in $listFiles
            do
              readFiles=$(cat ./DeploymentConfiguration/$i)
              echo $readFiles
              
              environmentName=$(echo ${readFiles} | jq '.[] | .environmentName')
              processName=($(echo ${readFiles} | jq '.[] | .processDetails[].processName'))
              componentID=($(echo  ${readFiles} | jq '.[] | .processDetails[].componentID'))
              packageVersion=($(echo  ${readFiles} | jq '.[] | .processDetails[].packageVersion'))
              mode=($(echo  ${readFiles} | jq '.[] | .processDetails[].mode'))
              deploymentID=($(echo  ${readFiles} | jq '.[] | .processDetails[].deploymentID'))
              echo $environmentName 
              echo $processName
              echo $componentID
              echo $packageVersion
              echo $mode
              echo $deploymentID

            done
